!function(f){f(function(){var o,s,e,l,n,c,p,i,d,a,t,r,u,g,y,_,m,v,P;o={priceInput:f("#lp_js_postPriceInput"),priceTypeInput:f("#lp_js_postPriceTypeInput"),revenueModel:f("#lp_js_postPriceRevenueModel"),categoryInput:f("#lp_js_postDefaultCategoryInput"),priceSection:f("#lp_js_priceType"),pricingTypeButtonGroup:f("#lp_js_priceTypeButtonGroup"),pricingTypeButtons:f(".lp_js_priceTypeButton"),individualPriceButton:f("#lp_js_useIndividualPrice").parent(),categoryPriceSelector:"#lp_js_useCategoryDefaultPrice",categoryPriceButton:f("#lp_js_useCategoryDefaultPrice").parent(),globalPriceButton:f("#lp_js_useGlobalDefaultPrice").parent(),postEditTypeZero:f("#lp_postEditTypeZero"),priceEditSection:f("#lp_js_priceEditSection").parent(),setPostFreeButton:f("#lp_js_setPostFree").parent(),postFreeDescription:f("#lp_js_free_postDescriptionSpan"),postPriceInputInfo:f("#lp_js_postPriceInputInfo").children(),details:f("#lp_js_priceTypeDetails"),detailsSections:f(".lp_js_priceTypeDetailsSection"),individualPriceDetails:f("#lp_js_priceTypeDetailsIndividualPrice"),categoryPriceDetails:f("#lp_js_priceTypeDetailsCategoryDefaultPrice"),categoriesList:f(".lp_js_priceTypeDetailsCategoryDefaultPriceList"),categories:f(".lp_js_priceTypeDetailsCategoryDefaultPriceItem"),dynamicPricingToggle:f("#lp_js_toggleDynamicPricing"),dynamicPricingContainer:"#lp_js_dynamicPricingWidgetContainer",dynamicPricingResetDate:f("#lp_js_resetDynamicPricingStartDate"),expanded:"lp_is-expanded",selected:"lp_is-selected",disabled:"lp_is-disabled",dynamicPricingApplied:"lp_is-withDynamicPricing",selectedCategory:"lp_is-selectedCategory",payPerUse:"ppu",singleSale:"sis"},s=[],e=function(){var e,i,t;lpVars.is_block_editor&&(e=wp.data.select("core/edit-post"),i=wp.data.select("core/editor"),t=i.getPostEdits().categories,wp.data.subscribe(function(){e.isSavingMetaBoxes()&&(window.tinyMCE&&window.tinyMCE.triggerSave(),v()),t!==i.getPostEdits().categories&&(s=i.getPostEdits().categories,a(),t=s)}))},l=function(e){var i,t,a,r=f(e),s=r.parent("li"),l=r.attr("id");s.hasClass(o.disabled)||s.hasClass(o.selected)||(f("."+o.selected,o.pricingTypeButtonGroup).removeClass(o.selected),s.addClass(o.selected),o.priceSection.removeClass(o.expanded),o.detailsSections.velocity("slideUp",{duration:250}),"lp_js_useIndividualPrice"===l?(o.priceEditSection.show(),o.priceEditSection.find("div.postPriceInputHolder").show(),o.priceEditSection.find("div#lp_js_priceEditSection").show(),"0"===lpVars.postPriceBehaviour&&o.postEditTypeZero.hide(),o.priceSection.addClass(o.expanded),o.dynamicPricingToggle.velocity("fadeIn",{duration:250,display:"block"}),o.priceTypeInput.val("individual price"),p(o.priceInput.val()),o.dynamicPricingToggle.text()===lpVars.i18nRemoveDynamicPricing&&(m(),o.individualPriceDetails.velocity("slideDown",{duration:250}))):"lp_js_useCategoryDefaultPrice"===l?(d(),t=(i=f(".lp_is-selectedCategory a",o.categoriesList)).attr("data-price"),a=i.attr("data-revenue-model"),n(t),c(a,!0),o.priceSection.addClass(o.expanded),o.categoryPriceDetails.velocity("slideDown",{duration:250}),o.categories.velocity("slideDown",{duration:250}),o.dynamicPricingToggle.velocity("fadeOut",{duration:250}),o.priceTypeInput.val("category default price")):"lp_js_useGlobalDefaultPrice"===l?("0"===lpVars.postPriceBehaviour&&(o.priceEditSection.hide(),o.postEditTypeZero.show()),t=r.attr("data-price"),a=r.attr("data-revenue-model"),n(t),c(a,!0),o.dynamicPricingToggle.velocity("fadeOut",{duration:250}),o.priceTypeInput.val("global default price")):"lp_js_setPostFree"===l&&(n(0),o.dynamicPricingToggle.velocity("fadeOut",{duration:250}),o.priceTypeInput.val("individual free")),"lp_js_useIndividualPrice"!==l||o.dynamicPricingToggle.hasClass(o.dynamicPricingApplied)?(o.dynamicPricingToggle.hasClass(o.dynamicPricingApplied)&&y(),o.priceInput.attr("disabled","disabled")):(o.priceInput.removeAttr("disabled"),setTimeout(function(){o.priceInput.focus()},50)))},n=function(e){var i=p(e);o.priceInput.val(i)},c=function(e,i){f("label",o.revenueModel).removeClass(o.selected),i&&f("input:radio[name=post_revenue_model]",o.revenueModel).parent("label").addClass(o.disabled),f("input:radio[value="+e+"]",o.revenueModel).prop("checked","checked").parent("label").removeClass(o.disabled).addClass(o.selected)},p=function(e){return e="string"==typeof(e=e.toString().replace(/[^0-9\,\.]/g,""))&&-1<e.indexOf(",")?parseFloat(e.replace(",",".")).toFixed(2):parseFloat(e).toFixed(2),isNaN(e)&&(e=0),(e=Math.abs(e))>lpVars.limits.sis_max?e=lpVars.limits.sis_max:0<e&&e<lpVars.limits.ppu_min&&(e=lpVars.limits.ppu_min),i(e),e=e.toFixed(2),-1!==lpVars.locale.indexOf("de_DE")&&(e=e.replace(".",",")),e},i=function(e){var i=f("input:radio:checked",o.revenueModel).val(),t=f("input:radio[value="+o.payPerUse+"]",o.revenueModel),a=f("input:radio[value="+o.singleSale+"]",o.revenueModel);0===e||e>=lpVars.limits.ppu_min&&e<=lpVars.limits.ppu_max?t.parent("label").removeClass(o.disabled):t.parent("label").addClass(o.disabled),e>=lpVars.limits.sis_min?a.parent("label").removeClass(o.disabled):a.parent("label").addClass(o.disabled),e>lpVars.limits.ppu_max&&i===o.payPerUse?a.prop("checked",!0):e<lpVars.limits.sis_min&&i===o.singleSale&&t.prop("checked",!0),f("label",o.revenueModel).removeClass(o.selected),f("input:radio:checked",o.revenueModel).parent("label").addClass(o.selected)},d=function(){var e,i,t,a=o.categoryInput.val(),r=o.categories.first();o.categories.length?(void 0!==a&&f("[data-category="+a+"]",o.categories.parent()).length?f("[data-category="+a+"]",o.categories.parent()).addClass(o.selectedCategory):(r.addClass(o.selectedCategory),o.categoryInput.val(r.data("category"))),o.categoryPriceButton.hasClass(o.selected)&&(i=(e=f(".lp_is-selectedCategory a",o.categoriesList)).attr("data-price"),t=e.attr("data-revenue-model"),n(i),c(t,!0))):o.categoryInput.val("")},a=function(){var e,i,t=f("#categorychecklist :checkbox:checked"),a=t.length,r=[];if(!lpVars.is_block_editor)for(s=[],e=0;e<a;e++)i=parseInt(t.eq(e).val(),10),s.push(i);f.post(lpVars.ajaxUrl,{action:"laterpay_get_category_prices",form:"laterpay_get_category_prices",category_ids:s},function(e){e.success&&e.prices&&(o.categoryPriceDetails.show(),o.categoryPriceDetails.css("opacity","unset"),e.prices.forEach(function(e){var i=parseFloat(e.category_price).toFixed(2)+" "+lpVars.currency,t="ppu"===e.revenue_model?lpVars.i18nPayLater:lpVars.i18nPayNow,a=f("<li/>",{"data-category":e.category_id,calss:"lp_price-type-categorized__item"}).append(f("<a/>",{href:"#","data-price":e.category_price,"data-revenue-model":e.revenue_model,text:e.category_name}).append(f("<br/>"),f("<span/>").text(i),f("<span/>",{class:"lp_badge lp_badge--revenue-model-global"}).text(t)));r.push(a)}),o.categoriesList.empty().append(r),e.prices.length?(o.categoryPriceButton.removeClass(o.disabled).removeClass(o.selected).removeClass("lp_tooltip"),o.categories=f("#lp_js_priceTypeDetailsCategoryDefaultPrice li"),l(o.categoryPriceSelector),o.globalPriceButton.addClass(o.disabled).addClass("lp_tooltip").attr("data-tooltip",lpVars.i18nGlobalDisabled)):(o.categoryPriceButton.addClass(o.disabled).addClass("lp_tooltip").attr("data-tooltip",lpVars.i18nCategoryPriceSelect),!0===e.no_category_price_set&&o.categoryPriceButton.attr("data-tooltip",lpVars.i18nCategoryPriceNotSetup),o.globalPriceButton.removeClass(o.disabled).removeClass("lp_tooltip"),o.detailsSections.velocity("fadeOut",{duration:250}),o.categoryPriceButton.hasClass(o.selected)&&(f("."+o.selected,o.pricingTypeButtonGroup).removeClass(o.selected),o.priceSection.removeClass(o.expanded),o.globalPriceButton.hasClass(o.disabled)?(o.individualPriceButton.addClass(o.selected),o.priceTypeInput.val("individual price"),o.dynamicPricingToggle.velocity("fadeIn",{duration:250,display:"block"}),o.priceInput.removeAttr("disabled"),n(0),c(o.payPerUse,!1)):(o.globalPriceButton.addClass(o.selected),o.priceTypeInput.val("global default price"),n(lpVars.globalDefaultPrice),c(f("a",o.globalPriceButton).attr("data-revenue-model"),!0)))),o.postFreeDescription.hide(),o.postPriceInputInfo.hide())},"json")},t=function(e){var i=f(e),t=i.parent(),a=t.attr("data-category"),r=i.attr("data-price"),s=i.attr("data-revenue-model");o.categories.removeClass(o.selectedCategory),t.addClass(o.selectedCategory),o.categoryInput.val(a),n(r),c(s,!0)},r=function(){o.dynamicPricingToggle.hasClass(o.dynamicPricingApplied)?(y(),o.revenueModel.velocity("fadeIn",{duration:250,display:"inline-block"})):g()},u=function(e){f.post(lpVars.ajaxUrl,{action:"laterpay_reset_post_publication_date",post_id:e},function(e){e.success?window.location.reload():e.message&&alert(e.message)},"json")},g=function(){m(),o.dynamicPricingToggle.addClass(o.dynamicPricingApplied),o.priceInput.attr("disabled","disabled"),o.individualPriceDetails.velocity("slideDown",{duration:250}),o.priceTypeInput.val("individual price, dynamic"),o.dynamicPricingToggle.text(lpVars.i18nRemoveDynamicPricing).attr("data-icon","e")},y=function(){_(),o.dynamicPricingToggle.removeClass(o.dynamicPricingApplied),o.individualPriceDetails.velocity("slideUp",{duration:250,complete:function(){f(o.dynamicPricingContainer).empty()}}),o.dynamicPricingResetDate.velocity("fadeOut",{duration:250}),o.dynamicPricingToggle.text(lpVars.i18nAddDynamicPricing).attr("data-icon","c"),"individual price, dynamic"===o.priceTypeInput.val()&&(o.priceTypeInput.val("individual price"),o.priceInput.removeAttr("disabled"))},_=function(){f.post(lpVars.ajaxUrl,{action:"laterpay_remove_post_dynamic_pricing",post_id:lpVars.postId},function(e){e.message&&alert(e.message)},"json")},m=function(){f.post(lpVars.ajaxUrl,{action:"laterpay_get_dynamic_pricing_data",post_id:lpVars.postId,post_price:o.priceInput.val()},function(e){var i,t,a,r,s;e&&(i=new DynamicPricingWidget(o.dynamicPricingContainer),t=e.values[0].y,a=e.values[3].y,r=0,s=5,window.dynamicPricingWidget=i,o.priceInput.attr("disabled","disabled"),r=t>lpVars.limits.ppu_max||a>lpVars.limits.ppu_max?(s=lpVars.limits.sis_max,lpVars.limits.sis_only_limit):t>=lpVars.limits.sis_min||a>=lpVars.limits.sis_min?(s=lpVars.limits.ppu_max,lpVars.limits.sis_min):(s=lpVars.limits.ppu_only_limit,lpVars.limits.ppu_min),0<e.price.pubDays&&e.price.pubDays<=30&&i.set_today(e.price.pubDays,e.price.todayPrice),4===e.values.length?i.set_data(e.values).setPrice(r,s,lpVars.globalDefaultPrice).plot():i.set_data(e.values).setPrice(r,s,lpVars.globalDefaultPrice).interpolate("step-before").plot())},"json")},v=function(){var e=jQuery("#lp_js_priceTypeButtonGroup li.lp_is-selected").text().trim(),i=100*p(o.priceInput.val()),t="Pricing for Post",a="LP WP Post",r=lpVars.gaData.sandbox_merchant_id+" | "+lpVars.postId+" | ";"Make Article Free"===e&&(e="FREE");var s,l,n=[];if(lpVars.is_block_editor?(s=f("div.editor-post-taxonomies__hierarchical-terms-list :checkbox:checked"),f.each(s,function(e){n.push(f(s[e]).next("label").text().trim())})):(l=f("#categorychecklist :checkbox:checked"),f.each(l,function(e){n.push(f("#"+l[e].id).parent().text().trim())})),lpGlobal.sendLPGAEvent("Post Published",a,r+n.join(",")),o.dynamicPricingToggle.hasClass(o.dynamicPricingApplied)){var c=window.dynamicPricingWidget.get_data();return 4===window.dynamicPricingWidget.get_data().length?(f("input[name=start_price]").val(c[0].y),f("input[name=end_price]").val(c[3].y),f("input[name=change_start_price_after_days]").val(c[1].x),f("input[name=transitional_period_end_after_days]").val(c[2].x),f("input[name=reach_end_price_after_days]").val(c[3].x),lpGlobal.sendLPGAEvent(t,a,r+e,Math.round(100*c[3].y)),lpGlobal.sendLPGAEvent(t,a,r+"Dynamic Price",Math.round(100*c[0].y))):3===window.dynamicPricingWidget.get_data().length&&(f("input[name=start_price]").val(c[0].y),f("input[name=end_price]").val(c[2].y),f("input[name=change_start_price_after_days]").val(c[1].x),f("input[name=transitional_period_end_after_days]").val(0),f("input[name=reach_end_price_after_days]").val(c[2].x)),!0}lpGlobal.sendLPGAEvent(t,a,r+e,i)},P=function(t,a){var r;return function(){var e=this,i=arguments;clearTimeout(r),r=setTimeout(function(){t.apply(e,i)},a)}},o.pricingTypeButtons.mousedown(function(){l(this)}).click(function(e){e.preventDefault()}),f("#post").submit(function(){v()}),e(),o.priceInput.keyup(P(function(){n(f(this).val())},800)),f("input:radio",o.revenueModel).change(function(){p(o.priceInput.val())}),o.dynamicPricingToggle.mousedown(function(){r()}).click(function(e){e.preventDefault()}),o.dynamicPricingResetDate.mousedown(function(){u(lpVars.postId)}).click(function(e){e.preventDefault()}),f(".categorychecklist input:checkbox").on("change",function(){a()}),o.categoryPriceDetails.on("mousedown","a",function(){t(this),o.postFreeDescription.hide(),o.postPriceInputInfo.hide()}).on("click","a",function(e){e.preventDefault()}),o.globalPriceButton.on("click","a",function(e){e.preventDefault(),o.globalPriceButton.hasClass("lp_is-disabled")||("0"===lpVars.postPriceBehaviour&&(o.priceEditSection.hide(),o.postEditTypeZero.show()),o.postFreeDescription.hide(),o.postPriceInputInfo.hide())}),o.individualPriceButton.on("click","a",function(e){e.preventDefault(),o.individualPriceButton.hasClass("lp_is-disabled")||("0"===lpVars.postPriceBehaviour&&o.postEditTypeZero.hide(),o.priceEditSection.show(),o.priceEditSection.find("div.postPriceInputHolder").show(),o.priceEditSection.find("div#lp_js_priceEditSection").show(),o.postPriceInputInfo.show(),o.postFreeDescription.hide())}),f(o.categoryPriceSelector).on("click",function(e){e.preventDefault(),f(o.categoryPriceSelector).parent().hasClass("lp_is-disabled")||(o.priceEditSection.show(),o.postFreeDescription.hide(),o.postPriceInputInfo.hide())}),f(o.setPostFreeButton).on("click",function(e){e.preventDefault(),o.setPostFreeButton.hasClass("lp_is-disabled")||(o.postFreeDescription.show(),o.postPriceInputInfo.hide())}),o.dynamicPricingToggle.hasClass(o.dynamicPricingApplied)&&m()})}(jQuery);