!function(g){g(function(){var b,_,o,a,r,t,h,l,n,u,i;b={body:g("body"),revenueModelInput:".lp_js_revenueModelInput",revenueModelContainer:".post_price_revenue_model",priceInput:".lp_js_priceInput",presetButtonAmount:".lp-amount-preset-button",customAmountWrapper:".lp-custom-amount-wrapper",selectedButton:".lp-amount-preset-button-selected",singleRevenueModel:g("#lp_single_contribution_revenue_model"),revenueModelMultiple:g("#lp_multiple_contribution_ul"),revenueModelMultipleItems:g("#lp_multiple_contribution_ul li"),revenueMultipleRadio:g("input:radio","#lp_multiple_contribution_ul"),navigation:g(".lp_navigation"),hideOnSinglePurchase:g(".hide-on-single-purchase"),contributionAllowMultiple:g("#lp_contribution_allow_multiple_amount"),contributionMultiplePurchaseOptions:g(".all_purchase_options"),contributionSinglePurchaseOption:g(".lp_single_contribution_dialog_options"),contributionCustom:g("#lp_contribution_allow_custom_amount"),contributionSingleButtonWrapper:g(".lp-dialog-single-button-wrapper"),contributionSinglePreviewButton:g("#lp_jsLinkSingle"),contributionMultipleWrapper:g(".lp-dialog-multiple-contribution-wrapper"),contributionGenerateCode:g("#lp_js_contributionGenerateCode"),customAmountInput:g("#lp_custom_amount_input"),contributionName:g("#lp_contribution_name"),thankYouPage:g("#lp_thank_you_page"),dialogHeader:g("#lp_dialog_header"),dialogDescription:g("#lp_dialog_description"),previewDialogHeader:g(".lp_contribution_preview .lp-header-text span"),previewDialogDescription:g(".lp_contribution_preview .lp-amount-text"),singleContributionPrice:g("#lp_single_contribution_price"),singleContributionForm:g("#lp_single_contribution_form"),contributionErrorMessageWrapper:g(".lp-contribution-error-wrapper"),contributionErrorMessage:".lp-contribution-error-message",contributionCustomErrorMessage:".lp-contribution-custom-error-message",payPerUse:"ppu",singleSale:"sis",disabled:"lp_is-disabled",selected:"lp_is-selected"},_=function(n){var i=["form","action","_wpnonce","_wp_http_referer"];return g.each(n,function(e,t){void 0!==t&&-1===i.indexOf(t.name)&&delete n[e]}),n=n.slice(0,4)},o=function(e,t,n,i){var o=g("multiple"===n?"#"+i.attr("id"):".lp_js_priceInput",e),r=o.val();return r=r.replace(/[^0-9\,\.]/g,""),r=parseFloat(r.replace(",",".")).toFixed(2),isNaN(r)&&(r=0),(r=Math.abs(r))>lpVars.currency.sis_max?r=lpVars.currency.sis_max:0<r&&r<lpVars.currency.ppu_min&&(r=lpVars.currency.ppu_min),t||a(r,e,n,i),r=r.toFixed(2),-1!==lpVars.locale.indexOf("de_DE")&&(r=r.replace(".",",")),o.val(r),r},a=function(e,t,n,i){var o,r,a,l=b.revenueModelInput,u="multiple"===n?(o=g("#"+i.attr("id"),t).parent().siblings(b.revenueModelContainer),r=g(o).find("input[value="+b.payPerUse+"]"),a=g(o).find("input[value="+b.singleSale+"]"),g(o).find("input:radio:checked").val()):(r=g(l+"[value="+b.payPerUse+"]",t),a=g(l+"[value="+b.singleSale+"]",t),g("input:radio:checked",t).val());0===e||e>=lpVars.currency.ppu_min&&e<lpVars.currency.ppu_max?r.removeProp("disabled").parent("label").removeClass(b.disabled):r.prop("disabled","disabled").parent("label").addClass(b.disabled),e>=lpVars.currency.sis_min?a.removeProp("disabled").parent("label").removeClass(b.disabled):a.prop("disabled","disabled").parent("label").addClass(b.disabled),e>=lpVars.currency.ppu_max&&u===b.payPerUse?a.prop("checked","checked"):e<lpVars.currency.sis_min&&u===b.singleSale&&r.prop("checked","checked"),"multiple"===n?(g(o).find("label").removeClass(b.selected),g(o).find("input:checked").parent("label").addClass(b.selected)):(g("label",t).removeClass(b.selected),g(l+":checked",t).parent("label").addClass(b.selected))},r=function(e,t,n){var i,o,r,a="USD"===lpVars.currency.code?" $":" â‚¬";"multiple"===n?(i=b.dialogHeader.val(),o=b.dialogDescription.val(),i=i||b.dialogHeader.attr("placeholder"),o=o||b.dialogDescription.attr("placeholder"),b.previewDialogHeader.text(i),b.previewDialogDescription.text(o),g(b.revenueModelMultipleItems).each(function(e){var t=e+1,n=g("#lp_multiple_contribution_input_"+t),i=g("#lp_js_multiple_amount_"+t),o=i.find(".lp-amount-preset-button"),r=n.val().length?n.val():"0.00";o.text(a+r),2!==t&&3!==t&&4!==t||n.val().length&&(g("#lp_multiple_contribution_li_"+(t+1)).show(),o.show()),3!==t&&4!==t&&5!==t||("0.00"!==r?i.show():i.hide())})):(r="ppu"===g("input:radio:checked",t).val()?lpVars.i18n.contribute+a+e+" "+lpVars.i18n.nowOrPayLater:lpVars.i18n.contribute+a+e+" "+lpVars.i18n.now,b.contributionSinglePreviewButton.text(r))},t=function(){var e=!0;b.contributionName.val().trim().length||(e=!1),e?b.contributionGenerateCode.attr("disabled",!1):b.contributionGenerateCode.attr("disabled",!0)},h=function(e,i,o){g.ajax({url:lpVars.ajaxUrl,method:"POST",data:e,dataType:"json"}).done(function(e){var t,n;b.navigation.showMessage(e),e.success&&(u(e.code),b.contributionGenerateCode.attr("data-icon","f"),b.contributionGenerateCode.css("opacity","0.4"),t="LP WP Contributions",n=lpVars.gaData.sandbox_merchant_id,lpGlobal.sendLPGAEvent("Contribution Options",t,n,i),lpGlobal.sendLPGAEvent("Custom contribution amount",t,n,o))})},l=function(){b.contributionGenerateCode.removeAttr("data-icon"),b.contributionGenerateCode.css("opacity","1")},n=function(e){return null!==e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)},u=function(e){var t=g("<input>");g("body").append(t),t.val(e).select(),document.execCommand("copy"),t.remove()},i=function(n,i){var o;return function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){n.apply(e,t)},i)}},function(){b.body.on("keyup",b.priceInput,i(function(){l();var e="single";"lp_multiple_contribution_form"===g(this).parents("form").attr("id")&&(e="multiple");var t=o(g(this).parents("form"),!1,e,g(this));r(t,g(this).parents("form"),e)},1500));function e(){l(),r(void 0,void 0,"multiple")}b.dialogHeader.on("keyup",i(e,500)),b.dialogDescription.on("keyup",i(e,500)),g(b.presetButtonAmount).on("click",function(){l();var e=g(this).parent().attr("id").slice(-1);g("#lp_js_multiple_amounts .lp-amount-preset-button").removeClass("lp-amount-preset-button-selected"),g(this).addClass("lp-amount-preset-button-selected");var t=g("#lp_multiple_contribution_input_"+e).val();r(t,g(this).parents("form"),"multiple")}),g("input:radio",b.singleRevenueModel).add(b.revenueMultipleRadio).change(function(){l();var e=g(this).parents("form").attr("id"),t=g(this),n="single";"lp_multiple_contribution_form"===e&&(n="multiple",t=g(this).parents(".post_price_revenue_model").siblings().find(".lp_js_priceInput"));var i=o(g(this).parents("form"),!1,n,t);r(i,g(this).parents("form"),n)}),b.contributionAllowMultiple.change(function(){l(),g(b.contributionCustomErrorMessage).hide(),g(this).prop("checked")?(g(this).val(1),b.hideOnSinglePurchase.show(),b.contributionMultiplePurchaseOptions.show(),b.contributionMultipleWrapper.show(),b.contributionSinglePurchaseOption.hide(),b.contributionSingleButtonWrapper.hide(),b.contributionCustom.attr("disabled",!1)):(g(this).val(0),b.contributionSinglePurchaseOption.show(),b.contributionSingleButtonWrapper.show(),b.hideOnSinglePurchase.hide(),b.contributionMultiplePurchaseOptions.hide(),b.contributionMultipleWrapper.hide(),b.contributionCustom.attr("disabled",!0))}),b.contributionCustom.change(function(){if(l(),g(this).prop("checked")){if(!b.contributionAllowMultiple.prop("checked"))return g(b.contributionCustomErrorMessage).text(lpVars.i18n.errorCustomAmount),g(b.contributionCustomErrorMessage).show(),g(this).attr("disabled","disabled"),!1;g(this).val(1),g(b.customAmountWrapper).show(),g(b.contributionCustomErrorMessage).hide()}else g(this).val(0),g(b.customAmountWrapper).hide()}),b.contributionName.on("keyup",i(function(){l(),t()},1e3)),b.thankYouPage.on("keyup",i(function(){l(),!g(this).val().trim().length||n(g(this).val())?(g(this).next(b.contributionErrorMessage).text(""),g(this).next(b.contributionErrorMessage).hide()):(g(this).next(b.contributionErrorMessage).text(lpVars.i18n.errorCampaignThanks),g(this).next(b.contributionErrorMessage).show())},1e3)),b.customAmountInput.on("focus input",i(function(){l();var e=o(g(this).parents("form"),!1,"multiple",g(this));g(this).val(e)},1500)),b.contributionGenerateCode.on("click",function(e){if(e.preventDefault(),!g(this).attr("disabled")){var t,n,i,l,o=1,u=[],r={},a=1,s=b.contributionName.val().length?b.contributionName.val():"",p=b.thankYouPage.val().length?b.thankYouPage.val():"",c="1"===b.contributionAllowMultiple.val()?"multiple":"single",d=b.dialogHeader.val(),m=b.dialogDescription.val();if(!s.trim().length)return b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).text(lpVars.i18n.errorCampaignName),b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).show(),!1;if("single"==c){if(!(t=b.singleContributionPrice.val()).length||0===parseFloat(t))return b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).text(lpVars.i18n.errorNoAmount),b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).show(),!1;n=g("input:radio:checked",b.singleContributionForm).val(),(r=_(g("#lp_single_contribution_form").serializeArray())).push({name:"contribution_name",value:s},{name:"thank_you_page",value:p},{name:"single_amount",value:t},{name:"single_revenue",value:n}),a=0}else{if(g(b.revenueModelMultipleItems).each(function(e){var t,n=e+1,i=g("#lp_multiple_contribution_input_"+n),o=(o=parseInt(i.val(),10)).toFixed(2),r=g("#post_price_revenue_model_"+n).find("input:checked").val(),a=g(".lp-amount-presets-wrapper").find(b.selectedButton);l=a.length?a.parent().attr("id").slice(-1):1,0<o&&(t={price:100*o,revenue:r,is_selected:parseInt(n)===parseInt(l)},u.push(t))}),u.length<2)return b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).text(lpVars.i18n.errorNoAmountMultiple),b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).show(),!1;o=u.length,a=b.contributionCustom.val(),(r=_(g("#lp_multiple_contribution_form").serializeArray())).push({name:"contribution_name",value:s},{name:"dialog_header",value:d},{name:"dialog_description",value:m},{name:"thank_you_page",value:p},{name:"all_amounts",value:JSON.stringify(u)}),"1"===b.contributionCustom.val()&&(i=b.customAmountInput.val(),r.push({name:"custom_amount",value:i}))}b.contributionErrorMessageWrapper.find(b.contributionErrorMessage).hide(),h(r,o,a)}})}(),b.contributionAllowMultiple.trigger("change"),b.contributionCustom.trigger("change"),b.contributionGenerateCode.attr("disabled",!0)})}(jQuery);