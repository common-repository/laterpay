!function(p){p(function(){"use strict";({init:function(){var a;"object"==typeof tinymce&&(a=this,tinymce.PluginManager.add("laterpay_shortcode_generator",function(e,t){a.register_dropdown(e,t)}))},object_to_string:function(e){if("object"!=typeof e)return"";var t="",a=0;for(a in e)e.hasOwnProperty(a)&&e[a]&&""!==e[a]&&(t+=a+'="'+e[a]+'" ');return t},colorbox_on_action:function(){if("object"==typeof tinymce){var e=tinymce.activeEditor,a=e.settings.color_picker_callback;return a?function(){var t=this;a.call(e,function(e){t.value(e).fire("change")},t.value())}:void 0}},onclick_media_button:function(){var c=this,e=c.settings.wp_media_args||{},s=wp.media(e);s.on("select",function(){var e,t,a,o,n,i,l,r,_=s.state().get("selection").first().toJSON();"object"==typeof _&&(e=_.url,void 0!==c.settings.save_id&&!0===c.settings.save_id&&(e=_.id),c.state.data.value=e,t="preview_"+c.settings.name,a=p("#"+t),o=p(".preview-image",a),n=p(".media-name",a),i=p(".button-clear_media",a),0!==o.length&&(l=_.url,r=_.filename,"video"===_.type?l=laterpay_shortcode_generator_labels.preview_images.video:"audio"===_.type?l=laterpay_shortcode_generator_labels.preview_images.audio:"text"===_.type?l=laterpay_shortcode_generator_labels.preview_images.text:"image"!==_.type&&(l=laterpay_shortcode_generator_labels.preview_images.no_preview_image),p(o).attr("src",l),p(n).attr("title",r).text(r),p(i).removeClass("hidden")))}),s.open()},get_media_markup:function(e){var t=laterpay_shortcode_generator_labels;return'<div id="preview_'+e+'" class="lp-media-preview" data-target_field="'+e+'"><img class="preview-image" src="'+t.preview_images.gallery+'"/><span class="media-name"></span><a class="button-clear_media hidden" href="javascript:">'+t.button.clear+'</a><br class="clear"/></div>'},on_clear_media:function(e,t){var a=p(e).parent(".lp-media-preview"),o=p(".preview-image",a),n=p(".media-name",a),i=p(".button-clear_media",a),l=p(a).data("target_field"),r=t.controlIdLookup,_="";if(p(o).attr("src",laterpay_shortcode_generator_labels.preview_images.gallery),p(n).attr("title","").text(""),p(i).addClass("hidden"),"object"==typeof r)for(_ in r)r.hasOwnProperty(_)&&l===r[_]._name&&(t.controlIdLookup[_].state.data.value="")},register_dropdown:function(o){var n=this;o.addButton("laterpay_shortcode_generator",{text:laterpay_shortcode_generator_labels.button.text,icon:"laterpay-logo",type:"menubutton",menu:[{text:laterpay_shortcode_generator_labels.premium_download.title,onclick:function(){var e=laterpay_shortcode_generator_labels.premium_download;o.windowManager.open({title:e.title,width:512,height:480,body:[{type:"button",name:"target_post_id",label:e.target_post_id.label,text:e.target_post_id.text,save_id:!0,onclick:n.onclick_media_button},{type:"container",label:" ",html:n.get_media_markup("target_post_id")},{type:"textbox",name:"heading_text",label:e.heading_text.label,value:e.heading_text.value},{type:"textbox",name:"description_text",label:e.description_text.label},{type:"listbox",name:"content_type",label:e.content_type.label,values:e.content_type.values},{type:"button",name:"teaser_image_path",label:e.teaser_image_path.label,text:e.teaser_image_path.text,wp_media_args:{library:{type:"image"}},onclick:n.onclick_media_button},{type:"container",label:" ",html:n.get_media_markup("teaser_image_path")}],onopen:function(){var e=this;p(".lp-media-preview .button-clear_media").on("click",function(){n.on_clear_media(this,e)})},onsubmit:function(e){var t="[laterpay_premium_download "+n.object_to_string(e.data)+" ]";o.insertContent(t)}})}},{text:laterpay_shortcode_generator_labels.time_pass_purchase_button.title,onclick:function(){var a=laterpay_shortcode_generator_labels.time_pass_purchase_button,e=[],t=380,e=a.id.values.length<=0?(t=50,[{type:"container",html:"<b>"+a.no_item_text+"</b>"}]):[{type:"listbox",name:"id",label:a.id.label,values:a.id.values},{type:"button",name:"custom_image_path",label:a.custom_image_path.label,text:a.custom_image_path.text,wp_media_args:{library:{type:"image"}},onclick:n.onclick_media_button},{type:"container",label:" ",html:n.get_media_markup("custom_image_path")},{type:"container",html:'<div style="text-align: center;letter-spacing: 5px;">-------- <span style="letter-spacing: 0;">'+a.or_text+"</span> --------</div>"},{type:"textbox",name:"button_text",label:a.button_text.label},{type:"colorbox",name:"button_background_color",label:a.button_background_color.label,value:a.button_background_color.value,onaction:n.colorbox_on_action},{type:"colorbox",name:"button_text_color",label:a.button_text_color.label,value:"#ffffff",onaction:n.colorbox_on_action}];o.windowManager.open({title:a.title,width:512,height:t,body:e,onopen:function(){var e=this;p(".lp-media-preview .button-clear_media").on("click",function(){n.on_clear_media(this,e)})},onsubmit:function(e){var t;a.id.values.length<=0||(t="[laterpay_time_pass_purchase "+n.object_to_string(e.data)+" ]",o.insertContent(t))}})}},{text:laterpay_shortcode_generator_labels.subscription_purchase_button.title,onclick:function(){var a=laterpay_shortcode_generator_labels.subscription_purchase_button,e=[],t=380,e=a.id.values.length<=0?(t=50,[{type:"container",html:"<b>"+a.no_item_text+"</b>"}]):[{type:"listbox",name:"id",label:a.id.label,values:a.id.values},{type:"button",name:"custom_image_path",label:a.custom_image_path.label,text:a.custom_image_path.text,wp_media_args:{library:{type:"image"}},onclick:n.onclick_media_button},{type:"container",label:" ",html:n.get_media_markup("custom_image_path")},{type:"container",html:'<div style="text-align: center;letter-spacing: 5px;">--------<span style="letter-spacing: 0;">'+a.or_text+"</span>--------</div>"},{type:"textbox",name:"button_text",label:a.button_text.label},{type:"colorbox",name:"button_background_color",label:a.button_background_color.label,value:a.button_background_color.value,onaction:n.colorbox_on_action},{type:"colorbox",name:"button_text_color",label:a.button_text_color.label,value:"#ffffff",onaction:n.colorbox_on_action}];o.windowManager.open({title:a.title,width:512,height:t,body:e,onopen:function(){var e=this;p(".lp-media-preview .button-clear_media").on("click",function(){n.on_clear_media(this,e)})},onsubmit:function(e){var t;a.id.values.length<=0||(t="[laterpay_subscription_purchase "+n.object_to_string(e.data)+" ]",o.insertContent(t))}})}}]})}}).init()})}(jQuery);