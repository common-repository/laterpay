!function(C){C(function(){function i(e){return C("<div/>",{id:"lp_js_voucherCodeFeedbackMessage",class:"lp_voucher__feedback-message",style:"display:none;"}).text(e)}function t(e){return C("<div/>",{id:"lp_js_voucherCodeFeedbackMessage",class:"lp_purchase-overlay__voucher-error"}).text(e)}function e(){C.ajax({url:lpVars.ajaxUrl,method:"GET",data:{action:"laterpay_preview_mode_render",post_id:lpVars.post_id},xhrFields:{withCredentials:!0}}).done(function(e){e&&(p.previewModePlaceholder.before(e).remove(),p.previewModeContainer=C("#lp_js_previewModeContainer"),p.previewModeForm=C("#lp_js_previewModeForm"),p.previewModeToggle=C("#lp_js_togglePreviewMode"),p.previewModeInput=C("#lp_js_previewModeInput"),p.previewModeVisibilityForm=C("#lp_js_previewModeVisibilityForm"),p.previewModeVisibilityToggle=C("#lp_js_togglePreviewModeVisibility"),p.previewModeVisibilityInput=C("#lp_js_previewModeVisibilityInput"),p.previewModeToggle.on("change",function(){h()}),p.previewModeVisibilityToggle.on("mousedown",function(){v()}).on("click",function(e){e.preventDefault()}))})}var a,o,n,r,p,l,s,d,u,c,_,h,v,f,m,y,b,g,w;p={body:C("body"),previewModePlaceholder:C("#lp_js_previewModePlaceholder"),previewModeContainer:"#lp_js_previewModeContainer",previewModeForm:"#lp_js_previewModeForm",previewModeToggle:"#lp_js_togglePreviewMode",previewModeInput:"#lp_js_previewModeInput",previewModeVisibilityForm:"#lp_js_previewModeVisibilityForm",previewModeVisibilityToggle:"#lp_js_togglePreviewModeVisibility",previewModeVisibilityInput:"#lp_js_previewModeVisibilityInput",optionContainer:".lp_purchase-overlay-option",optionInput:".lp_purchase-overlay-option__input",submitButtonText:".lp_purchase-overlay__submit-text",timePass:".lp_js_timePass",flipTimePassLink:".lp_js_flipTimePass",timePassPreviewPrice:".lp_js_timePassPreviewPrice",voucherCodeWrapper:"#lp_js_voucherCodeWrapper",voucherCodeInput:".lp_js_voucherCodeInput",voucherRedeemButton:".lp_js_voucherRedeemButton",giftCardRedeemButton:".lp_js_giftCardRedeemButton",giftCardCodeInput:".lp_js_giftCardCodeInput",giftCardWrapper:"#lp_js_giftCardWrapper",giftCardActionsPlaceholder:".lp_js_giftCardActionsPlaceholder",giftsWrapper:C(".lp_js_giftsWrapper"),subscription:".lp_js_subscription",flipSubscriptionLink:".lp_js_flipSubscription",postContentPlaceholder:C("#lp_js_postContentPlaceholder"),purchaseOverlay:".lp_js_overlayPurchase",currentOverlay:'input[name="lp_purchase-overlay-option"]:checked',hidden:"lp_is-hidden",fadingOut:"lp_is-fading-out",premiumBox:".lp_js_premium-file-box",redeemVoucherBlock:C(".lp_purchase-overlay__voucher"),notificationButtons:C(".lp_js_notificationButtons"),notificationCancel:C(".lp_js_notificationCancel"),voucherCancel:".lp_js_voucherCancel",redeemVoucherButton:".lp_js_redeemVoucher",overlayMessageContainer:".lp_js_purchaseOverlayMessageContainer",overlayTimePassPrice:".lp_js_timePassPrice",lp_already_bought:".lp_bought_notification",lp_preset_buttons:".lp-amount-preset-button",lp_custom_amount:C(".lp-custom-amount-input"),lp_custom_amount_wrapper:C(".lp-custom-input-wrapper"),lp_singleContribution:C(".lp-link-single")},l=function(e,t,a){"custom"===e&&0},s=function(e){return e="string"==typeof(e=e.toString().replace(/[^0-9\,\.]/g,""))&&-1<e.indexOf(",")?parseFloat(e.replace(",",".")).toFixed(2):parseFloat(e).toFixed(2),isNaN(e)&&(e=.05),1e3<(e=Math.abs(e))?e=1e3:e<.05&&(e=.05),e=e.toFixed(2)},d=function(e){return"buy"===e&&(window.location.href=C(p.currentOverlay).val()),"voucher"===e&&(C(p.overlayMessageContainer).html(""),u(C(p.overlayMessageContainer),t,C(p.voucherCodeInput,p.redeemVoucherBlock),"purchase-overlay",!1)),!1},u=function(a,i,o,n,r,e){var l=C(o).val();e="number"==typeof e?e:0,"string"!=typeof n&&(n="global"),6===l.length?C.ajax({url:lpVars.ajaxUrl,method:"GET",data:{action:"laterpay_redeem_voucher_code",code:l,type:n,pass_id:e,link:window.location.href,lp_post_id:void 0!==lpVars.post_id?lpVars.post_id:""},xhrFields:{withCredentials:!0},dataType:"json"}).done(function(e){var t;C(o).val(""),e.success?r?C("#fakebtn").attr("data-laterpay",e.url).click():(t=!1,"time_pass"===e.type&&C(p.timePass).each(function(){if(C(this).data("pass-id")===e.pass_id)return!(t=!0)}),"subscription"===e.type&&C(p.subscription).each(function(){if(C(this).data("sub-id")===e.sub_id)return!(t=!0)}),"global"===e.type&&(t=!0),t?window.location.href=e.url:c(l+lpVars.i18n.invalidVoucher,i,n,a)):c(l+lpVars.i18n.invalidVoucher,i,n,a)}):c(lpVars.i18n.codeTooShort,i,n,a)},c=function(e,t,a,i){var o=t(e);"purchase-overlay"===a&&i.empty().append(o),""!==a&&"global"!==a&&"timepass"!==a&&"subscription"!==a||(i.prepend(o),(o=C("#lp_js_voucherCodeFeedbackMessage",i)).fadeIn(250).click(function(){_(o)}),setTimeout(function(){_(o)},3e3))},_=function(e){e.fadeOut(250,function(){e.unbind().remove()})},h=function(){p.previewModeToggle.prop("checked")?p.previewModeInput.val(1):p.previewModeInput.val(0),C.ajax({url:lpVars.ajaxUrl,method:"POST",data:p.previewModeForm.serializeArray(),xhrFields:{withCredentials:!0}}).done(function(){window.location.reload()})},v=function(){var e=p.previewModeContainer.hasClass(p.hidden)?"0":"1";p.previewModeVisibilityInput.val(e),p.previewModeContainer.toggleClass(p.hidden),C.ajax({url:lpVars.ajaxUrl,method:"POST",data:p.previewModeVisibilityForm.serializeArray(),xhrFields:{withCredentials:!0}})},f=function(e){var t=C(e);void 0!==C(e).data("content-type")&&"link"===C(e).data("content-type").toString()&&(t=C(this).find("span.lp_shortcode_link")),t.data("preview-as-visitor")&&alert(lpVars.i18n.alert)},m=function(){var e=g("laterpay_download_attached");e&&(b("laterpay_download_attached"),window.location.href=e)},y=function(e){C(e).parents(".lp_time-pass").toggleClass("lp_is-flipped")},b=function(e){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/"},g=function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},w=function(a,i){var o;return function(){var e=this,t=arguments;clearTimeout(o),o=setTimeout(function(){a.apply(e,t)},i)}},1===p.previewModePlaceholder.length&&e(),1<=C(p.premiumBox).length&&(a=[],o=[],n=C(p.premiumBox),C.each(n,function(e){a.push(C(n[e]).data("post-id")),o.push(C(n[e]).data("content-type"))}),C.ajax({url:lpVars.ajaxUrl,method:"GET",data:{action:"laterpay_get_premium_shortcode_link",ids:a,types:o,parent_pid:lpVars.post_id},xhrFields:{withCredentials:!0},dataType:"json"}).done(function(e){var a;e.data&&(a=null,C.each(e.data,function(t){a=e.data[t],C.each(n,function(e){C(n[e]).data("post-id").toString()===t&&("link"===C(n[e]).data("content-type").toString()&&C(a).attr("href")?C(n[e]).attr("href",C(a).attr("href")).removeClass("lp_premium_link"):C(n[e]).prepend(a))})})),m()})),r=lpVars.gaData.postTitle+","+lpVars.gaData.blogName+","+lpVars.gaData.postPermalink,p.body.on("mousedown",".lp_js_doPurchase, .lp_premium_link",function(){f(this)}).on("click",".lp_js_doPurchase, .lp_premium_link",function(e){e.preventDefault();var t=C(this);void 0!==C(this).data("content-type")&&"link"===C(this).data("content-type").toString()&&(t=C(this).find("span.lp_shortcode_link")),t.data("preview-post-as-visitor")?alert(lpVars.i18n.alert):t.data("laterpay")&&(lpGlobal.sendLPGAEvent("Paid Content Purchase","LaterPay WordPress Plugin",r),window.location.href=t.data("laterpay"))}),p.body.on("mousedown",p.purchaseOverlay,function(){f(this)}).on("click",p.purchaseOverlay,function(e){e.preventDefault(),C(this).data("preview-post-as-visitor")?alert(lpVars.i18n.alert):(lpGlobal.sendLPGAEvent("Paid Content Purchase","LaterPay WordPress Plugin",r),d(C(this).attr("data-purchase-action")))}),p.body.on("click",p.optionContainer,function(){switch(C('input[name="lp_purchase-overlay-option"]').removeProp("checked"),C(this).find(p.optionInput).prop("checked","checked"),C(this).data("revenue")){case"sis":C(p.submitButtonText).text(lpVars.i18n.revenue.sis);break;case"sub":C(p.submitButtonText).text(lpVars.i18n.revenue.sub);break;case"ppu":default:C(p.submitButtonText).text(lpVars.i18n.revenue.ppu)}}),p.body.on("click",p.redeemVoucherButton,function(e){e.preventDefault(),p.redeemVoucherBlock.removeClass("lp_hidden"),p.notificationButtons.addClass("lp_hidden"),p.notificationCancel.removeClass("lp_hidden"),C(p.purchaseOverlay).find('[data-buy-label="true"]').addClass("lp_hidden"),C(p.purchaseOverlay).find('[data-voucher-label="true"]').removeClass("lp_hidden"),C(p.purchaseOverlay).attr("data-purchase-action","voucher")}),p.body.on("click",p.voucherCancel,function(e){e.preventDefault(),p.redeemVoucherBlock.addClass("lp_hidden"),p.notificationButtons.removeClass("lp_hidden"),p.notificationCancel.addClass("lp_hidden"),C(p.purchaseOverlay).find('[data-buy-label="true"]').removeClass("lp_hidden"),C(p.purchaseOverlay).find('[data-voucher-label="true"]').addClass("lp_hidden"),C(p.purchaseOverlay).attr("data-purchase-action","buy")}),p.body.on("click",p.flipTimePassLink,function(e){e.preventDefault(),y(this)}),p.body.on("click",p.flipSubscriptionLink,function(e){e.preventDefault(),y(this)}),C(p.voucherRedeemButton).on("mousedown",function(){var e=C(this).data("type"),t=C(this).data("id"),a=C(this).parent();u(a,i,C(p.voucherCodeInput,a),e,!1,t)}).on("click",function(e){e.preventDefault()}),C(p.giftCardRedeemButton).on("mousedown",function(){var e=C(this).data("type"),t=C(this).data("id"),a=C(this).parent();u(a,i,C(p.giftCardCodeInput,a),e,!0,t)}).on("click",function(e){e.preventDefault()}),p.body.on("click",p.lp_already_bought,function(e){e.preventDefault();var t=lpVars.gaData.postTitle+","+lpVars.gaData.blogName+","+lpVars.gaData.postPermalink;lpGlobal.sendLPGAEvent("Paid Content Identify","LaterPay WordPress Plugin",t),window.location.href=C(this).attr("href")}),C(p.lp_preset_buttons).click(function(){C(this).parents(".lp-amount-presets").find(".lp-amount-preset-button").removeClass("lp-amount-preset-button-selected"),C(this).addClass("lp-amount-preset-button-selected"),l(null,null,C(this).data("revenue"))}),p.lp_custom_amount.keyup(w(function(){C(this).parents(".lp-body-wrapper").find(".lp-amount-preset-button").removeClass("lp-amount-preset-button-selected");var e=s(C(this).val());C(this).val(e);var t=Math.round(100*C(this).val());l("custom",t)},800)),C(".lp-contribution-button").click(function(){var e,t,a=C(this).parents(".lp-body-wrapper").find(".lp-amount-preset-button-selected");t=a.length?a.data("url"):300<(e=100*p.lp_custom_amount.val())?p.lp_custom_amount_wrapper.data("sis-url")+"&custom_pricing="+lpVars.default_currency+e:p.lp_custom_amount_wrapper.data("ppu-url")+"&custom_pricing="+lpVars.default_currency+e,window.open(t)}),p.lp_singleContribution.click(function(){window.open(C(this).data("url")+"&custom_pricing="+lpVars.default_currency+C(this).data("amount"))})})}(jQuery);