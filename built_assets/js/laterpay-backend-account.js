!function(p){p(function(){function o(){s()?(l.hasInvalidSandboxCredentials.val(1),l.pluginVisibilityToggle.prop("checked",!1),l.testMerchantId.focus(),l.showMerchantContractsButton.velocity("fadeIn",{duration:250}),l.requestSent=!1):l.hasInvalidSandboxCredentials.val(0)}var l,n,r,e,c,t,i,s,a,d;l={apiKeyInput:p(".lp_js_validateApiKey"),merchantIdInput:p(".lp_js_validateMerchantId"),testMerchantId:p("#lp_js_sandboxMerchantId"),testApiKey:p("#lp_js_sandboxApiKey"),liveMerchantId:p("#lp_js_liveMerchantId"),liveApiKey:p("#lp_js_liveApiKey"),pluginModeIndicator:p("#lp_js_pluginModeIndicator"),pluginModeToggle:p("#lp_js_togglePluginMode"),pluginVisibilitySetting:p("#lp_js_pluginVisibilitySetting"),hasInvalidSandboxCredentials:p("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",navigation:p(".lp_navigation"),region:p("#lp_js_apiRegionSection"),regionNoticeBlock:p("#lp_js_regionNotice"),showMerchantContractsButton:p("#lp_js_showMerchantContracts"),apiCredentials:p("#lp_js_apiCredentialsSection"),requestSent:!1,hide_cache_warning:p("#hide_cache_warning"),lp_cache_warning:p("#lp_cache_warning"),lp_account_login:p("#lp_account_login")},n=l.region.val(),r=function(){var e=l.pluginModeToggle,n=e.prop("checked");s()?(e.prop("checked",!1),l.liveMerchantId.focus(),l.requestSent=!1,l.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"})):n?(l.pluginVisibilitySetting.velocity("fadeOut",{duration:250}),l.showMerchantContractsButton.velocity("fadeOut",{duration:250})):l.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"}),c("laterpay_plugin_mode")},e=function(){p.post(ajaxurl,p("#laterpay_region").serializeArray(),function(e){l.navigation.showMessage(e),e.success?(n=l.region.val(),l.testMerchantId.val(e.creds.cp_key),l.testApiKey.val(e.creds.api_key),"eu"!==n?l.regionNoticeBlock.removeClass("hidden"):l.regionNoticeBlock.addClass("hidden")):l.region.val(n)},"json"),setTimeout(function(){l.pluginModeToggle.prop("checked")&&d()},2e3)},c=function(i){l.requestSent||(l.requestSent=!0,p.post(ajaxurl,p("#"+i).serializeArray(),function(e){l.navigation.showMessage(e),"live"===e.mode?p("#lp_js_pluginModeIndicator").velocity("fadeOut",{duration:250}):p("#lp_js_pluginModeIndicator").velocity("fadeIn",{duration:250})},"json").done(function(){var e,n,t;l.requestSent=!1,"laterpay_plugin_mode"===i&&(e=l.pluginModeToggle.prop("checked")?"Live":"Test",n=p("#lp_js_liveMerchantId").val(),l.pluginModeToggle.prop("checked")&&l.lp_cache_warning.show(),t=lpVars.gaData.sb_merch_id_status+" | "+n+" | "+lpVars.gaData.site_url+" | ",lpGlobal.sendLPGAEvent("Account Status Change","LP WP Account",t+e)),"laterpay_plugin_mode"!==i&&"laterpay_live_merchant_id"!==i&&"laterpay_live_api_key"!==i||setTimeout(function(){l.pluginModeToggle.prop("checked")&&d()},2e3)}))},t=function(e){var n,t=p(e),i=t.parents("form"),a=t.val().trim();a.length!==t.val().length&&t.val(a),0===a.length||32===a.length?c(i.attr("id")):(l.navigation.showMessage(lpVars.i18nApiKeyInvalid,!1),n=l.testApiKey.parents("form").attr("id"),i.attr("id")===n&&o()),s()&&r()},i=function(e){var n,t=p(e),i=t.parents("form"),a=t.val().trim();a.length!==t.val().length&&t.val(a),0===a.length||22===a.length?c(i.attr("id")):(l.navigation.showMessage(lpVars.i18nMerchantIdInvalid,!1),n=l.testMerchantId.parents("form").attr("id"),i.attr("id")===n&&o()),s()&&r()},s=function(){var e=32!==l.liveApiKey.val().length||22!==l.liveMerchantId.val().length;return l.pluginModeToggle.prop("checked")&&e},a=function(){if(s())return lpVars.i18nPreventUnload},d=function(){p.post(lpVars.ajaxUrl,{action:"laterpay_validate_cred_region",security:lpVars.validate_cred_nonce},function(e){e.hasOwnProperty("mode")&&(l.pluginModeToggle.prop("checked",!1),l.navigation.showMessage(e))},"json")},l.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){t(e)},50)}),l.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){i(e)},50)}),l.region.change(function(){e()}),l.pluginModeToggle.change(function(){r()}),l.showMerchantContractsButton.bind("click",function(){return p(this).attr("href",p(this).data("href-"+l.region.val())),!0}),l.lp_account_login.bind("click",function(){return p(this).attr("href",p(this).data("href-"+l.region.val())),!0}),window.onbeforeunload=function(){a()},l.hide_cache_warning.on("click",function(){p.post(lpVars.ajaxUrl,{action:"laterpay_reset_notice_data",security:lpVars.reset_cache_nonce},function(e){e.success&&l.lp_cache_warning.hide()},"json")})})}(jQuery);